<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nasoro AI</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/tokyo-night-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { margin:0; font-family:'Space Grotesk',sans-serif; background:#050505; color:white; overflow:hidden; height:100vh; }
#sidebar { width:280px; background:rgba(10,10,10,0.95); backdrop-filter:blur(30px); position:fixed; left:0; top:0; bottom:0; transform:translateX(-100%); transition:0.3s; display:flex; flex-direction:column; padding:1.5rem; border-right:1px solid rgba(255,255,255,0.05); }
.sidebar-active { transform:translateX(0); }
#overlay { position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; z-index:999; }
.overlay-visible { display:block; }
#chat-container { flex:1; overflow-y:auto; padding:1.5rem; margin-left:280px; }
textarea { width:100%; background:transparent; color:white; border:none; resize:none; outline:none; }
.msg { margin-bottom:1rem; }
.msg-user { text-align:right; }
.msg-nasoro { text-align:left; }
</style>
</head>
<body class="flex">

<div id="overlay" onclick="closeSidebar()"></div>

<aside id="sidebar">
<h1 class="text-xl font-bold mb-4">Nasoro AI</h1>
<div id="model-list" class="flex flex-col gap-2"></div>
<button onclick="location.reload()" class="mt-auto bg-white text-black rounded px-4 py-2">New Chat</button>
</aside>

<main style="flex:1; display:flex; flex-direction:column;">
<header style="padding:1rem; background:rgba(5,5,5,0.8); backdrop-filter:blur(20px); position:sticky; top:0; z-index:100;">Nasoro AI</header>

<div id="chat-container"></div>

<div style="padding:1rem; display:flex; gap:0.5rem; background:rgba(15,15,15,0.9); position:sticky; bottom:0;">
<textarea id="chat-field" rows="1" placeholder="Talk with Nasoro..."></textarea>
<button id="send-action" style="background:white; color:black; padding:0 1rem;">Send</button>
</div>
</main>

<script>
const NASORO_TIERS = [
  { name:"1.2 Fast", tier:"Oro-1.2-fast" },
  { name:"1.2 Pro", tier:"Oro-1.2-pro" },
  { name:"2 Fast", tier:"Oro-2-fast" },
  { name:"2 Pro", tier:"Oro-2-pro" },
  { name:"2 Chat Oro", tier:"Oro-2-chat" }
];
let selectedTier = NASORO_TIERS[0].tier;

const sidebar=document.getElementById('sidebar');
const overlay=document.getElementById('overlay');
const chatContainer=document.getElementById('chat-container');
const chatField=document.getElementById('chat-field');
const sendAction=document.getElementById('send-action');

function openSidebar(){sidebar.classList.add('sidebar-active'); overlay.classList.add('overlay-visible');}
function closeSidebar(){sidebar.classList.remove('sidebar-active'); overlay.classList.remove('overlay-visible');}

function renderModels(){
  const container=document.getElementById("model-list");
  container.innerHTML = NASORO_TIERS.map(m=>{
    return `<div onclick="selectTier('${m.tier}')" style="padding:0.5rem; cursor:pointer; border-radius:0.5rem; background:rgba(255,255,255,0.05);">${m.name}</div>`;
  }).join('');
}
renderModels();
function selectTier(tier){selectedTier=tier;}

function postMessage(content, role){
  const div=document.createElement('div');
  div.className='msg '+(role==='nasoro'?'msg-nasoro':'msg-user');
  div.innerHTML=content.replace(/\n/g,'<br>');
  chatContainer.appendChild(div);
  chatContainer.scrollTop=chatContainer.scrollHeight;
}

async function handleSend(){
  const msg=chatField.value.trim();
  if(!msg) return;
  postMessage(msg,'user');
  chatField.value='';
  try{
    const res = await fetch("/ai", { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({message:msg, tier:selectedTier})});
    const data = await res.json();
    postMessage(data.reply || "Thinking...", 'nasoro');
  }catch{
    postMessage("Sync failed. Check backend connection.", 'nasoro');
  }
}

sendAction.addEventListener('click', handleSend);
chatField.addEventListener('keydown', e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault(); handleSend();}});
</script>
</body>
</html>
