<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Nasoro</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/base16/one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              bg: '#000000',
              card: '#0A0A0A',
              border: '#1A1A1A',
              accent: '#FFFFFF',
              text: '#EDEDED',
              dim: '#A1A1A1'
            }
          }
        }
      }
    }
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Geist:wght@100;300;400;600;800&display=swap');
    
    body { 
      background-color: #000000; 
      color: #EDEDED; 
      font-family: 'Geist', sans-serif;
      -webkit-font-smoothing: antialiased; 
    }
    
    /* Code block styling */
    pre { 
      background: #0F0F0F !important; 
      border: 1px solid #1A1A1A; 
      border-radius: 12px; 
      padding: 1.25rem; 
      margin: 1.5rem 0; 
      overflow-x: auto;
      position: relative;
    }

    code { font-family: 'Menlo', 'Monaco', monospace; font-size: 0.85rem; line-height: 1.6; }

    /* Hide scrollbars */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    
    /* Message styling */
    .prose p { margin-bottom: 1rem; line-height: 1.7; }
    .prose strong { color: #fff; font-weight: 600; }

    /* Input focus effect */
    .input-container:focus-within {
      border-color: #444;
      box-shadow: 0 0 0 1px #444;
    }

    .fade-up { animation: fadeUp 0.3s ease-out forwards; }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="h-screen flex overflow-hidden">

  <aside class="hidden md:flex flex-col w-64 bg-brand-bg border-r border-brand-border p-5">
    <div class="flex items-center gap-2 mb-10 px-2">
      <div class="h-6 w-6 bg-white rounded-full"></div>
      <span class="text-xl font-bold tracking-tight">Nasoro</span>
    </div>

    <button onclick="location.reload()" class="flex items-center justify-between w-full p-3 rounded-xl border border-brand-border hover:bg-brand-card transition-all text-sm group">
      <span>New Chat</span>
      <i class="fa-solid fa-pen-to-square text-brand-dim group-hover:text-white"></i>
    </button>

    <div class="mt-8 flex-1 overflow-y-auto no-scrollbar space-y-4">
      <div class="text-[10px] font-bold text-brand-dim uppercase tracking-widest">History</div>
      <div class="space-y-1">
        <div class="p-2.5 rounded-lg hover:bg-brand-card text-sm text-brand-dim hover:text-white cursor-pointer truncate">Exploring Quantum Physics</div>
        <div class="p-2.5 rounded-lg hover:bg-brand-card text-sm text-brand-dim hover:text-white cursor-pointer truncate">Modern UI Trends</div>
      </div>
    </div>

    <div class="mt-auto border-t border-brand-border pt-4">
      <div class="flex items-center gap-3 p-2 rounded-xl hover:bg-brand-card cursor-pointer transition">
        <div class="w-7 h-7 bg-zinc-800 rounded-full flex items-center justify-center text-[10px]">US</div>
        <span class="text-sm font-medium">User Settings</span>
      </div>
    </div>
  </aside>

  <main class="flex-1 flex flex-col relative h-full">
    
    <header class="md:hidden flex items-center justify-between p-4 border-b border-brand-border bg-black">
      <span class="font-bold">Nasoro</span>
      <i class="fa-solid fa-bars"></i>
    </header>

    <div id="chat-container" class="flex-1 overflow-y-auto pt-10 pb-48 px-4 md:px-0">
      <div id="welcome-screen" class="max-w-xl mx-auto text-center mt-20 space-y-6">
        <div class="h-16 w-16 bg-white rounded-3xl mx-auto rotate-12 flex items-center justify-center">
            <span class="text-black text-3xl font-black -rotate-12">N</span>
        </div>
        <h2 class="text-3xl font-semibold tracking-tight">What's the plan for today?</h2>
        <div class="grid grid-cols-2 gap-3 text-left">
            <div class="p-4 border border-brand-border rounded-2xl hover:bg-brand-card cursor-pointer transition text-xs text-brand-dim">
                "Write a short story about a neon-lit city..."
            </div>
            <div class="p-4 border border-brand-border rounded-2xl hover:bg-brand-card cursor-pointer transition text-xs text-brand-dim">
                "Explain the laws of thermodynamics..."
            </div>
        </div>
      </div>
    </div>

    <div class="absolute bottom-0 left-0 w-full p-4 md:pb-10 bg-gradient-to-t from-black via-black/90 to-transparent">
      <div class="max-w-3xl mx-auto">
        
        <div id="preview-tray" class="hidden flex gap-2 p-3 bg-brand-card border border-brand-border border-b-0 rounded-t-2xl"></div>

        <div class="input-container flex items-end gap-2 p-2 bg-brand-card border border-brand-border rounded-2xl transition-all">
          
          <label class="w-10 h-10 flex items-center justify-center rounded-xl cursor-pointer hover:bg-zinc-800 transition shadow-sm">
            <i class="fa-solid fa-plus text-brand-dim"></i>
            <input type="file" id="image-upload" class="hidden" accept="image/*" multiple>
          </label>

          <textarea 
            id="user-input" 
            rows="1" 
            placeholder="Message Nasoro..."
            class="flex-1 bg-transparent border-none focus:ring-0 py-2 text-brand-text placeholder-brand-dim text-base max-h-64 resize-none"
          ></textarea>

          <button id="send-btn" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white text-black hover:opacity-90 disabled:opacity-30 disabled:hover:opacity-30 transition">
            <i class="fa-solid fa-arrow-up"></i>
          </button>
        </div>
        <p class="text-[10px] text-center mt-3 text-brand-dim tracking-widest uppercase">Nasoro v1.0 â€¢ General Intelligence</p>
      </div>
    </div>
  </main>

  <script>
    const chatContainer = document.getElementById('chat-container');
    const welcomeScreen = document.getElementById('welcome-screen');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const imageUpload = document.getElementById('image-upload');
    const previewTray = document.getElementById('preview-tray');

    let attachments = [];

    // Image handling
    imageUpload.addEventListener('change', (e) => {
      const files = Array.from(e.target.files);
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = (ev) => {
          attachments.push(ev.target.result);
          renderPreviews();
        }
        reader.readAsDataURL(file);
      });
    });

    function renderPreviews() {
      if(attachments.length > 0) {
        previewTray.classList.remove('hidden');
        previewTray.innerHTML = attachments.map((img, i) => `
          <div class="relative w-14 h-14 rounded-lg overflow-hidden border border-brand-border group">
            <img src="${img}" class="w-full h-full object-cover">
            <div onclick="removeImg(${i})" class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer">
              <i class="fa-solid fa-xmark text-white text-xs"></i>
            </div>
          </div>
        `).join('');
      } else {
        previewTray.classList.add('hidden');
      }
    }

    window.removeImg = (i) => {
      attachments.splice(i, 1);
      renderPreviews();
    }

    // Input auto-grow
    userInput.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = this.scrollHeight + 'px';
    });

    function addMessage(content, role) {
      welcomeScreen.classList.add('hidden');
      const isNasoro = role === 'nasoro';
      
      const html = `
        <div class="fade-up max-w-3xl mx-auto flex gap-5 mb-10">
          <div class="w-7 h-7 rounded-full flex-shrink-0 mt-1 flex items-center justify-center ${isNasoro ? 'bg-white text-black' : 'bg-zinc-800 text-white'}">
            <span class="text-[10px] font-bold">${isNasoro ? 'N' : 'U'}</span>
          </div>
          <div class="flex-1 space-y-2 min-w-0">
            <div class="prose prose-invert max-w-none text-brand-text font-light tracking-wide">
              ${isNasoro ? marked.parse(content) : content.replace(/\n/g, '<br>')}
            </div>
          </div>
        </div>
      `;
      chatContainer.insertAdjacentHTML('beforeend', html);
      document.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el));
      chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
    }

    async function send() {
      const val = userInput.value.trim();
      if(!val && attachments.length === 0) return;

      addMessage(val, 'user');
      
      // Clear UI
      userInput.value = '';
      userInput.style.height = 'auto';
      const sentAttachments = [...attachments];
      attachments = [];
      renderPreviews();
      sendBtn.disabled = true;

      try {
        const res = await fetch("https://nasoroai-production.up.railway.app/ai", {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: val, images: sentAttachments, provider: "openai" })
        });
        const data = await res.json();
        addMessage(data.reply || "Thinking...", 'nasoro');
      } catch {
        addMessage("Failed to connect to Nasoro.", 'nasoro');
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener('click', send);
    userInput.addEventListener('keydown', e => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); } });
  </script>
</body>
    </html>
    
